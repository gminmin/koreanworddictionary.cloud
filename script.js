const translations = {
    ko: {
        "nav.home": "홈",
        "nav.about": "동아리 소개",
        "nav.gallery": "작품 갤러리",
        "nav.pursuit": "추구하는 바",
        "nav.workflow": "워크플로우",
        "nav.contact": "문의하기",
        "nav.title": "진부중학교 3D 동아리",
        "hero.title": "상상을 현실로,<br>창작의 세계",
        "hero.subtitle": "진부중학교 3D 동아리입니다.",
        "hero.cta": "작품 보러가기",
        "about.title": "About",
        "about.subtitle": "창의력과 기술의 만남",
        "about.desc": "3D 창작물을 통해 우리가 오랫동안 기억하고 싶은것, 이제는 볼수없는것, 현실에 없는것을 만들어냅니다. 그리고 그 배경에는 무료 오픈소스 프로그램 'Blender'가 있습니다.",
        "gallery.title": "Gallery",
        "gallery.subtitle": "부원들의 열정이 담긴 작품들입니다.",
        "gallery.more": "더 많은 작품 보기",
        "footer.club": "진부중학교 3D 동아리",
        "footer.address": "강원특별자치도 평창군 진부면",
        "gallery.page.title": "전체 작품 갤러리",
        "gallery.page.subtitle": "동아리 부원들의 창의적인 작품들을 모두 만나보세요.",
        "gallery.work.2025": "2025년도 작품",
        "pursuit.more": "동아리의 방향",
        "pursuit.title": "Pursuit",
        "pursuit.subtitle": "추구하는 바는 다음과 같습니다.",
        "pursuit.page.title": "추구하는 바",
        "pursuit.page.subtitle": "동아리의 정체성을 정리하였습니다.",
        "pursuit.value1.title": "자유로운 창작",
        "pursuit.value1.desc": "우리는 자유를 지향합니다.<br>당신의 엉뚱하고 기발한 아이디어,<br>그 모든 것이 예술이 되는 공간입니다.",
        "pursuit.value2.title": "자신만의 스타일",
        "pursuit.value2.desc": "유행을 따르기보다 나만의 스타일을 찾습니다. 부원 각자가 가진 고유한 개성과 감성이<br>작품에 자연스럽게 스며들도록 합니다.",
        "pursuit.value3.title": "끊임없는 도전",
        "pursuit.value3.desc": "실패는 또 다른 배움의 기회입니다.<br>Blender의 수많은 기능을 탐구하고<br>새로운 기법을 시도하며 매일 성장합니다.",
        "pursuit.vision.title": "VISION",
        "pursuit.vision.desc": "<strong>'상상은 현실이 된다'</strong><br><br>진부중학교 3D 동아리는 단순한 툴 학습을 넘어,<br>창작을 위한 새로운 언어를 배웁니다.<br>우리는 서로 영감을 주고받으며 함께 성장합니다.",
        "pursuit.style.title": "우리의 스타일",
        "pursuit.style.desc": "미래를 향한 첫 걸음, 트렌드를 넘어서는 데서 시작됩니다.",
        "pursuit.style.desc2": "미니멀니즘, 과도한 디테일은 필요하지 않습니다.",
        "workflow.subtitle": "작품이 만들어지는 6단계 과정입니다.",
        "workflow.step1.title": "아이디어",
        "workflow.step1.desc": "무엇을 만들지 상상하고 구체화합니다.",
        "workflow.step2.title": "기획",
        "workflow.step2.desc": "레퍼런스를 수집하고 전체적인 설계를 합니다.",
        "workflow.step3.title": "모델링",
        "workflow.step3.desc": "3D 공간에 물체의 형태를 만듭니다.",
        "workflow.step4.title": "리깅/애니메이팅",
        "workflow.step4.desc": "뼈대를 심고 움직임을 부여합니다.",
        "workflow.step5.title": "텍스쳐링",
        "workflow.step5.desc": "재질과 색상을 입혀 리얼리티를 더합니다.",
        "workflow.step6.title": "렌더",
        "workflow.step6.desc": "조명과 카메라를 설정하여 최종 이미지를 출력합니다.",
        "workflow.start_experience": "직접 경험해보기",
        "workflow.start_experience_sub": "웹 브라우저에서 바로 작동하는 3D 가상 스튜디오를 체험해보세요."
    },
    en: {
        "nav.home": "Home",
        "nav.about": "About",
        "nav.gallery": "Gallery",
        "nav.pursuit": "Pursuit",
        "nav.workflow": "Workflow",
        "nav.contact": "Contact",
        "nav.title": "Jinbu Middle School 3D Club",
        "hero.title": "Imagination to Reality,<br>World of Creation",
        "hero.subtitle": "Jinbu Middle School 3D Club",
        "hero.cta": "View Works",
        "about.title": "About",
        "about.subtitle": "Where Creativity Meets Technology",
        "about.desc": "We turn ideas into reality through 3D modeling. and we learn various tools like 'Blender' and grow together.",
        "gallery.title": "Gallery",
        "gallery.subtitle": "Works filled with our members' passion.",
        "gallery.more": "View More Works",
        "footer.club": "Jinbu Middle School 3D Club",
        "footer.address": "Jinbu-myeon, Pyeongchang-gun, Gangwon-do",
        "gallery.page.title": "Full Gallery",
        "gallery.page.subtitle": "Explore all creative works by our members.",
        "gallery.work.2025": "2025 Work",
        "workflow.subtitle": "The 6-step creation process.",
        "workflow.step1.title": "Idea",
        "workflow.step1.desc": "Imagine and conceptualize what to create.",
        "workflow.step2.title": "Planning",
        "workflow.step2.desc": "Collect references and plan the overall design.",
        "workflow.step3.title": "Modeling",
        "workflow.step3.desc": "Create the shape of the object in 3D space.",
        "workflow.step4.title": "Rigging/Animating",
        "workflow.step4.desc": "Add bones and movement to the model.",
        "workflow.step5.title": "Texturing",
        "workflow.step5.desc": "Apply materials and colors for realism.",
        "workflow.step6.title": "Render",
        "workflow.step6.desc": "Set lighting and camera to output the final image.",
        "workflow.start_experience": "Experience it yourself",
        "workflow.start_experience_sub": "Try the 3D Virtual Studio that works right in your browser.",
        "pursuit.more": "More about our club",
        "pursuit.title": "Pursuit",
        "pursuit.subtitle": "The Pursuit of the club is as follows.",
        "pursuit.page.title": "Our Pursuit",
        "pursuit.page.subtitle": "Defining the identity of our club.",
        "pursuit.value1.title": "Free Creation",
        "pursuit.value1.desc": "We aim for freedom without boundaries.<br>Your wacky and brilliant ideas,<br>turn into art in this space.",
        "pursuit.value2.title": "Unique Style",
        "pursuit.value2.desc": "We find our own voice rather than following trends.<br>We encourage each member's unique personality<br>to naturally permeate their work.",
        "pursuit.value3.title": "Non-stop Challenge",
        "pursuit.value3.desc": "Failure is another opportunity to learn.<br>We explore Blender's countless features<br>and grow every day by trying new techniques.",
        "pursuit.vision.title": "Our Vision",
        "pursuit.vision.desc": "<strong>'Imagination Becomes Reality'</strong><br><br>Beyond simple technical skills,<br>we learn a new language to express ourselves in the digital world.<br>We inspire each other and grow together as 3D artists.",
        "pursuit.style.title": "Our Style",
        "pursuit.style.desc": "We embrace minimalism, where unnecessary details are not needed.",
        "pursuit.style.desc2": "We embrace minimalism, where unnecessary details are not needed."
    }
};

let currentLang = 'ko';

function updateLanguage(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;

    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            el.innerHTML = translations[lang][key];
        }
    });

    const dropbtns = document.querySelectorAll('.lang-dropbtn');
    dropbtns.forEach(btn => {
        btn.innerHTML = lang === 'ko' ? '한국어 ▾' : 'English ▾';
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // --- Navbar Scroll Effect ---
    const navbar = document.querySelector('.navbar');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 20) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // --- Intersection Observer for Fade-in Animations ---
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    const animatedElements = document.querySelectorAll('.section-title, .section-subtitle, .about-text, .about-image, .workflow-text, .workflow-image, .gallery-item, .glass-card, .vision-section, .hero-title, .brand-identity-section');
    animatedElements.forEach(el => {
        el.classList.add('fade-in');
        observer.observe(el);
    });

    // --- Smooth Scrolling ---
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });

    // --- Language Selection ---
    const langLinks = document.querySelectorAll('[data-lang]');
    langLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const lang = e.target.getAttribute('data-lang');
            updateLanguage(lang);
        });
    });
    updateLanguage('ko');

    // --- Logo Comparison Slider ---
    function initComparisons() {
        const container = document.querySelector('.img-comp-container');
        const overlay = document.querySelector('.img-comp-overlay');
        const handle = document.querySelector('.comp-slider-handle');
        if (!container || !overlay || !handle) return;

        let clicked = 0;
        let w = container.offsetWidth;
        slide(w / 2);

        handle.addEventListener("mousedown", slideReady);
        handle.addEventListener("touchstart", slideReady);
        container.addEventListener("mousedown", slideReady);
        container.addEventListener("touchstart", slideReady);
        window.addEventListener("mouseup", slideFinish);
        window.addEventListener("touchend", slideFinish);

        function slideReady(e) {
            e.preventDefault();
            clicked = 1;
            container.classList.add('dragging');
            window.addEventListener("mousemove", slideMove);
            window.addEventListener("touchmove", slideMove);
            slideMove(e);
        }

        function slideFinish() {
            clicked = 0;
            container.classList.remove('dragging');
            window.removeEventListener("mousemove", slideMove);
            window.removeEventListener("touchmove", slideMove);
        }

        function slideMove(e) {
            if (clicked == 0) return;
            let pos = getCursorPos(e);
            if (pos < 0) pos = 0;
            if (pos > w) pos = w;
            slide(pos);
        }

        function getCursorPos(e) {
            e = (e.changedTouches) ? e.changedTouches[0] : e;
            const a = container.getBoundingClientRect();
            return e.clientX - a.left;
        }

        function slide(x) {
            overlay.style.width = x + "px";
            handle.style.left = overlay.offsetWidth + "px";
        }
    }
    initComparisons();

    // --- Color Palette Copy ---
    const colorSwatches = document.querySelectorAll('.color-swatch-item');
    colorSwatches.forEach(swatch => {
        swatch.addEventListener('click', () => {
            const colorCode = swatch.getAttribute('data-color');
            const codeElement = swatch.querySelector('.color-code');
            const originalText = codeElement.innerText;

            const showSuccess = () => {
                codeElement.innerText = "Copied!";
                codeElement.style.color = "#4ade80";
                setTimeout(() => {
                    codeElement.innerText = originalText;
                    codeElement.style.color = "";
                }, 1500);
            };

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(colorCode).then(showSuccess);
            } else {
                const textArea = document.createElement("textarea");
                textArea.value = colorCode;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showSuccess();
            }
        });
    });

    // --- Neon Pipeline Progress & Node Activation ---
    const workflowSection = document.querySelector('.workflow-section');
    const pipelineFill = document.querySelector('.pipeline-fill');
    const workflowNodes = document.querySelectorAll('.workflow-node-item');

    function updateTimeline() {
        if (!workflowSection || !pipelineFill) return;

        const windowHeight = window.innerHeight;
        const system = document.querySelector('.workflow-system');
        if (!system) return;

        const systemRect = system.getBoundingClientRect();
        const isMobile = window.innerWidth <= 768;

        // 1. Pipeline Progress
        // Mobile needs slightly different trigger points to feel right
        const drawPoint = windowHeight * (isMobile ? 0.5 : 0.6);
        let progress = (drawPoint - systemRect.top) / systemRect.height;
        progress = Math.max(0, Math.min(1, progress));
        pipelineFill.style.height = `${progress * 100}%`;

        // 2. Atmosphere Shift
        if (progress > 0.05 && progress < 0.95) {
            document.body.classList.add('workflow-active');
        } else {
            document.body.classList.remove('workflow-active');
        }

        // 3. Precise Node Activation
        // On mobile, trigger closer to the center of the screen
        const activationZone = windowHeight * (isMobile ? 0.55 : 0.65);
        workflowNodes.forEach(node => {
            const nodePoint = node.querySelector('.node-point');
            if (!nodePoint) return;
            const pointRect = nodePoint.getBoundingClientRect();
            const pointCenter = pointRect.top + (pointRect.height / 2);

            if (pointCenter < activationZone) {
                node.classList.add('active');
            } else {
                node.classList.remove('active');
            }
        });
    }

    window.addEventListener('scroll', () => {
        requestAnimationFrame(updateTimeline);
    });
    updateTimeline();

    // --- 3D Magnet Interaction ---
    const workflowCards = document.querySelectorAll('.workflow-card');
    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    if (!isTouchDevice) {
        workflowCards.forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = ((y - centerY) / centerY) * -10;
                const rotateY = ((x - centerX) / centerX) * 10;
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.03, 1.03, 1.03)`;
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = '';
            });
        });
    }

    // --- Mouse Parallax ---
    const heroTitle = document.querySelector('.hero-title');
    const heroSubtitle = document.querySelector('.hero-subtitle');
    const globalBg = document.querySelector('.global-background');

    document.addEventListener('mousemove', (e) => {
        const xPos = (e.clientX / window.innerWidth - 0.5) * 2;
        const yPos = (e.clientY / window.innerHeight - 0.5) * 2;
        if (heroTitle) heroTitle.style.transform = `translate(${xPos * -20}px, ${yPos * -20}px)`;
        if (heroSubtitle) heroSubtitle.style.transform = `translate(${xPos * -10}px, ${yPos * -10}px)`;
        if (globalBg) globalBg.style.transform = `translate(${xPos * 10}px, ${yPos * 10}px) scale(1.1)`;
    });

    window.addEventListener('scroll', () => {
        const scrolled = window.scrollY;
        const aboutImage = document.querySelector('.about-image img');
        if (aboutImage) {
            aboutImage.style.transform = `translateY(${scrolled * 0.1}px)`;
        }
    });
});
